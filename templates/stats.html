<div class="summary-grid">
    <div class="summary-card income">
        <div class="summary-label">Total Income</div>
        <div class="summary-value">${{ "%.2f"|format(income) }}</div>
    </div>
    <div class="summary-card expense">
        <div class="summary-label">Total Expenses</div>
        <div class="summary-value">${{ "%.2f"|format(expenses) }}</div>
    </div>
    <div class="summary-card net">
        <div class="summary-label">Net Balance</div>
        <div class="summary-value">${{ "%.2f"|format(net) }}</div>
    </div>
</div>

{% if monthly %}
<div class="charts-container">
    <div class="chart-card">
        <h3>{% if selected_category %}{{ selected_category|capitalize }} - {% endif %}Category Distribution</h3>
        <canvas id="categoryChart"></canvas>
    </div>
    <div class="chart-card">
        <h3>{% if selected_category %}{{ selected_category|capitalize }} - {% endif %}Monthly Trend</h3>
        <canvas id="monthlyChart"></canvas>
    </div>
</div>

<script>
    // Fetch chart data and render charts
    const categoryFilter = '{{ selected_category or "" }}';
    const timeRange = '{{ time_range or "" }}';
    const startDate = '{{ start_date or "" }}';
    const endDate = '{{ end_date or "" }}';
    
    let url = '/api/chart-data';
    const params = [];
    
    if (categoryFilter) params.push(`category=${categoryFilter}`);
    if (timeRange) params.push(`range=${timeRange}`);
    if (startDate) params.push(`start_date=${startDate}`);
    if (endDate) params.push(`end_date=${endDate}`);
    
    if (params.length > 0) {
        url += '?' + params.join('&');
    }
    
    fetch(url)
        .then(response => response.json())
        .then(data => {
            // Category Pie Chart
            const categoryCtx = document.getElementById('categoryChart');
            if (categoryCtx && data.categories.labels.length > 0) {
                new Chart(categoryCtx, {
                    type: 'doughnut',
                    data: {
                        labels: data.categories.labels.map(l => l.charAt(0).toUpperCase() + l.slice(1)),
                        datasets: [{
                            label: 'Expenses',
                            data: data.categories.expenses,
                            backgroundColor: [
                                '#d63031', '#0984e3', '#d63384', '#e17055',
                                '#00b894', '#6c5ce7', '#636e72', '#fdcb6e',
                                '#ff7675', '#74b9ff'
                            ],
                            borderWidth: 2,
                            borderColor: '#fff'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 15,
                                    font: { size: 12 }
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return context.label + ': $' + context.parsed.toFixed(2);
                                    }
                                }
                            }
                        }
                    }
                });
            }
            
            // Monthly Line Chart
            const monthlyCtx = document.getElementById('monthlyChart');
            if (monthlyCtx && data.monthly.labels.length > 0) {
                new Chart(monthlyCtx, {
                    type: 'line',
                    data: {
                        labels: data.monthly.labels,
                        datasets: [
                            {
                                label: 'Income',
                                data: data.monthly.income,
                                borderColor: '#00b894',
                                backgroundColor: 'rgba(0, 184, 148, 0.1)',
                                borderWidth: 3,
                                fill: true,
                                tension: 0.4,
                                pointRadius: 5,
                                pointBackgroundColor: '#00b894',
                                pointBorderColor: '#fff',
                                pointBorderWidth: 2
                            },
                            {
                                label: 'Expenses',
                                data: data.monthly.expenses,
                                borderColor: '#d63031',
                                backgroundColor: 'rgba(214, 48, 49, 0.1)',
                                borderWidth: 3,
                                fill: true,
                                tension: 0.4,
                                pointRadius: 5,
                                pointBackgroundColor: '#d63031',
                                pointBorderColor: '#fff',
                                pointBorderWidth: 2
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        interaction: {
                            mode: 'index',
                            intersect: false,
                        },
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top'
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return context.dataset.label + ': $' + context.parsed.y.toFixed(2);
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return '$' + value.toFixed(0);
                                    }
                                },
                                grid: {
                                    color: 'rgba(0, 0, 0, 0.05)'
                                }
                            },
                            x: {
                                grid: {
                                    display: false
                                }
                            }
                        }
                    }
                });
            }
        });
</script>
{% endif %}

{% if not selected_category and category_breakdown %}
<div class="card" style="margin-top: 20px;">
    <h3 style="margin-bottom: 15px; color: #333;">Category Breakdown</h3>
    <table style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr style="border-bottom: 2px solid #e0e0e0;">
                <th style="text-align: left; padding: 12px; color: #333;">Category</th>
                <th style="text-align: right; padding: 12px; color: #00b894;">Income</th>
                <th style="text-align: right; padding: 12px; color: #d63031;">Expenses</th>
                <th style="text-align: right; padding: 12px; color: #333;">Net</th>
            </tr>
        </thead>
        <tbody>
            {% for cat in category_breakdown %}
            <tr style="border-bottom: 1px solid #f0f0f0;">
                <td style="padding: 12px; text-transform: capitalize;">{{ cat[0] }}</td>
                <td style="padding: 12px; text-align: right; color: #00b894; font-weight: 600;">${{ "%.2f"|format(cat[2]) }}</td>
                <td style="padding: 12px; text-align: right; color: #d63031; font-weight: 600;">${{ "%.2f"|format(cat[1]) }}</td>
                <td style="padding: 12px; text-align: right; font-weight: 600;">${{ "%.2f"|format(cat[2] - cat[1]) }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}
