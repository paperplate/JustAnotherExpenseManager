{% if transactions %}
{# Display transactions for a single month #}
<div style="margin-bottom: 30px;">
    <h3 style="color: #333; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #e0e0e0;">
        {{ current_month|replace('-', ' ')|title }}
    </h3>

    <table class="transactions-table">
        <thead>
            <tr>
                <th>Date</th>
                <th>Description</th>
                <th>Type</th>
                <th>Category & Tags</th>
                <th>Amount</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {% for trans in transactions %}
            <tr>
                <td>{{ trans.date }}</td>
                <td>{{ trans.description }}</td>
                <td>
                    <span class="type-badge type-{{ trans.type.value }}">
                        {{ trans.type.value|capitalize }}
                    </span>
                </td>
                <td>
                    {% for tag in trans.tags %}
                        {% if tag.is_category %}
                            <span class="tag-badge category-tag">
                                {{ tag.category_name|capitalize }}
                            </span>
                        {% else %}
                            <span class="tag-badge">
                                {{ tag.name }}
                            </span>
                        {% endif %}
                    {% endfor %}
                </td>
                <td class="amount amount-{{ trans.type.value }}">
                    {% if trans.is_income %}+{% else %}-{% endif %}${{ "%.2f"|format(trans.amount_dollars) }}
                </td>
                <td>
                    <button class="btn btn-edit btn-small"
                            data-transaction-id="{{ trans.id }}"
                            data-description="{{ trans.description|escape }}"
                            data-amount="{{ trans.amount_dollars }}"
                            data-type="{{ trans.type.value }}"
                            data-date="{{ trans.date }}"
                            data-category="{{ trans.category or '' }}"
                            data-tags="{{ trans.non_category_tags|join(',') }}"
                            onclick="editTransaction(this)">
                        Edit
                    </button>
                    <button class="btn btn-delete"
                            onclick="deleteTransaction({{ trans.id }})">
                        Delete
                    </button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    {# Monthly summary totals.
       NOTE: month_income and month_expense are computed in Python (routes/transactions.py)
       and passed as explicit template variables.  Do NOT try to accumulate them with
       {% set %} inside a {% for %} loop ‚Äî Jinja2 scopes loop-body assignments to the
       loop block, so the outer variables always stay 0. #}
    <div class="monthly-totals" style="margin-top: 10px; padding: 10px; background: #f9f9f9; border-radius: 6px; display: flex; gap: 20px; font-size: 14px;">
        <div class="total-income" style="color: #00b894;">
            <strong>Income:</strong> <span class="total-income-value">${{ "%.2f"|format(month_income) }}</span>
        </div>
        <div class="total-expense" style="color: #d63031;">
            <strong>Expenses:</strong> <span class="total-expense-value">${{ "%.2f"|format(month_expense) }}</span>
        </div>
        <div class="total-net" style="color: #333;">
            <strong>Net:</strong> <span class="total-net-value">${{ "%.2f"|format(month_income - month_expense) }}</span>
        </div>
        <div style="color: #666; margin-left: auto;">
            <strong>Transactions:</strong> {{ transactions|length }}
        </div>
    </div>
</div>

<!-- Month Navigation (Pagination) -->
{% if pagination.total_pages > 1 %}
<div style="display: flex; justify-content: center; align-items: center; gap: 10px; margin-top: 20px;">
    {% if pagination.page > 1 %}
        <button class="btn" onclick="loadTransactions({{ pagination.page - 1 }})">
            ‚Üê Previous Month
        </button>
    {% endif %}

    <span style="color: #666; font-weight: 600;">
        Month {{ pagination.page }} of {{ pagination.total_pages }}
    </span>

    {% if pagination.page < pagination.total_pages %}
        <button class="btn" onclick="loadTransactions({{ pagination.page + 1 }})">
            Next Month ‚Üí
        </button>
    {% endif %}
</div>
<div style="text-align: center; margin-top: 10px; color: #666;">
    Total: {{ pagination.total }} transactions across {{ pagination.total_pages }} months
</div>
{% endif %}

{% else %}
<div class="empty-state">
    <p style="font-size: 3rem;">üìù</p>
    <p>No transactions yet. Add your first transaction above or load test data from Settings!</p>
</div>
{% endif %}
